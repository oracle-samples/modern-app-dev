resource "oci_vulnerability_scanning_container_scan_recipe" "container__repository_scan_recipe" {
  compartment_id = var.compartment_id
  scan_settings {
    scan_level = local.scan_level
  }
}

resource "oci_vulnerability_scanning_container_scan_target" "test_container_scan_target" {
  compartment_id           = var.compartment_id
  container_scan_recipe_id = oci_vulnerability_scanning_container_scan_recipe.container__repository_scan_recipe.id
  target_registry {
    compartment_id = var.compartment_id
    type           = "OCIR"
    repositories   = local.repositories
    url            = local.region_ocir_url
  }

  description  = "Container scan target example"
  display_name = "${var.label_prefix} Container images scan target"
}

locals {
  scan_level      = "STANDARD"
  repositories    = var.repositories
  region_ocir_url = "https://${var.region}.ocir.io/"
}